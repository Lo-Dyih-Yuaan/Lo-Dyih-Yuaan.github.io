<!DOCTYPE html>
<html>
<head> 
<meta charset="utf-8">
<title>像素板</title>
<script src="PixelCanvas.js"></script>
<script src="data.js"></script>
</head>
<body>
<div id="colors"></div>
<div id="patterns"></div>
<hr/>
<canvas id="canvas">您的浏览器不支持canvas。</canvas>
<button onclick="pixelCanvas.save()">保存</button>
<script>
	let canvas = document.getElementById("canvas");
	pixelCanvas = new PixelCanvas(canvas, anshan2.width, anshan2.height, anshan2.colors, 'Z');
	pixelCanvas.canvas.onclick = function (event) {
		let pixelSize = pixelCanvas.pixelSize;
		let borderSize = pixelCanvas.borderSize;
		let elementSize = pixelSize + borderSize;
		let x = event.pageX - canvas.offsetLeft;
		let y = event.pageY - canvas.offsetTop;
		let j = parseInt(x/elementSize);
		let i = parseInt(y/elementSize);
		if (x%elementSize >= borderSize && y%elementSize >= borderSize)
			pixelCanvas.daub(i, j);
	};
	function clickButton(text, onclick, style = {}) {
		let button = document.createElement('button');
		button.textContent = text;
		button.onclick = onclick;
		Object.assign(button.style, style);
		return button;
	}
	let colorsButton = document.getElementById("colors");
	colorsButton.style.display='grid';
	colorsButton.style.gridTemplateColumns = `repeat(${Object.keys(anshan2.colors).length}, 1fr)`;
	for (let c in anshan2.colors)
		colorsButton.appendChild(clickButton(
			c == 'Z' ? "擦除" : c,
			function () { pixelCanvas.fillColor = c; },
			{background: `linear-gradient(to right, ${anshan2.colors[c]}, white, ${anshan2.colors[c]})`}));
	let patternsButton = document.getElementById("patterns");
	patternsButton.style.display='grid';
	patternsButton.style.gridTemplateColumns = `repeat(${anshan2.patterns.length+1}, 1fr)`;
	for (let i in anshan2.patterns)
		patternsButton.appendChild(clickButton(parseInt(i)+1, () => { pixelCanvas.paint(anshan2.patterns[i]); }));
	patternsButton.appendChild(clickButton("清空", () => { pixelCanvas.paint("Z"); }));
</script>
</body>
</html>
